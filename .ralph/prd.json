[
  {
    "title": "Unify retained pipeline for Luau runtime",
    "description": "- Pick a single source of truth for the retained pipeline (recommended: `src/retained/`).\n- Update `src/integrations/solid/` to be a thin wrapper over the canonical pipeline (or remove it from the build) so `src/integrations/native_renderer/*` and `src/integrations/luau_ui/mod.zig` run the same style/layout/render code.\n- Keep the public driver surface stable (node ops + EventRing). Do not add/restore any `dvui_retained_*` C ABI exports.\n- Success: `zig build luau` still runs, renders a basic UI, and `on_event(kind, id, detail)` continues to fire.",
    "complete": false,
    "priority": "critical",
    "complexity": "high"
  },
  {
    "title": "Acceptance scene for UI_FEATURES parity",
    "description": "- Expand `scripts/native_ui.luau` (or add a selectable script path) to cover the acceptance requirements in `DVUI_RETAINED.md`: positioned `div`, wrapped/aligned `text`, tinted `image` with placeholder, a `flex` container with `order-*`, and a scroll region.\n- Register listeners to exercise the EventRing: `mouseenter`/`mouseleave`, `scroll`, `click`, `input`, `keydown`, `keyup`, `pointer*`/`drag*` (where relevant).\n- Make the scene self-verifying via `on_event(...)` logs and obvious visual state changes.\n- Success: running `zig build luau` lets a human validate all interactions in under 2 minutes.",
    "complete": false,
    "priority": "critical",
    "complexity": "medium"
  },
  {
    "title": "UIFrame: percent/scale layout for position and size",
    "description": "- Add percent support to Tailwind parsing for insets and sizing (e.g. `left-[10%]`, `top-[0%]`, `w-[50%]`, `h-[25%]`) in `src/retained/style/tailwind.zig`.\n- Update `src/retained/layout/mod.zig` to compute percent-based values relative to the parent rect, while keeping existing px behavior unchanged.\n- Extend spacing tokens to support percent-based padding/margin where needed (UIPadding: percent or offset).\n- Success: the acceptance scene can position/size nodes using relative (0..1 / %) layout, not only pixel tokens.",
    "complete": false,
    "priority": "high",
    "complexity": "high"
  },
  {
    "title": "UIFrame: anchor/pivot semantics",
    "description": "- Define the retained contract for anchor/pivot (layout pivot vs transform pivot) and document it in code.\n- Implement anchor-aware positioning for absolutely positioned nodes so `anchorX/anchorY` can act like a UIFrame pivot (e.g. top/left refer to the pivot point, not always the top-left corner).\n- Ensure rotation/scale continue to pivot correctly and picking/getNodeRect match what is rendered.\n- Success: the acceptance scene includes at least one anchored element that stays correctly positioned while rotating/scaling.",
    "complete": false,
    "priority": "high",
    "complexity": "medium"
  },
  {
    "title": "UIAspectRatioConstraint: aspect-* tokens",
    "description": "- Add Tailwind tokens to `src/retained/style/tailwind.zig`: `aspect-[ratio]` plus `aspect-dominant-w` / `aspect-dominant-h`.\n- Enforce aspect ratio in `src/retained/layout/mod.zig` by deriving the non-dominant size before laying out children.\n- Success: the acceptance scene includes at least one aspect-constrained element that maintains its ratio during resize.",
    "complete": false,
    "priority": "high",
    "complexity": "medium"
  },
  {
    "title": "TextFrame parity (text tag)",
    "description": "- Update `renderText` in `src/retained/render/mod.zig` to combine parent + node class specs (node overrides parent).\n- Implement horizontal + vertical alignment controls (tokens and/or explicit props) and pass them through DVUI label/text rendering.\n- Ensure wrapping defaults to on; `text-nowrap` disables; `break-words` works.\n- Add auto-scale-to-fit (shrink text to fit rect) as an opt-in token/flag.\n- Add stroke/outline (width + color) with a minimal multi-pass render approach.\n- Success: the acceptance scene shows wrapped + aligned text, an auto-fit label, and a stroked label.",
    "complete": false,
    "priority": "high",
    "complexity": "high"
  },
  {
    "title": "ImageFrame parity (image tag)",
    "description": "- Extend node props and rendering in `src/retained/render/mod.zig` to support: fit mode (stretch/contain/cover), tint color, image opacity, and an image-only transform (separate from node transform).\n- Replace spammy logging for missing/unresolved images with cached failure state + placeholder rendering (neutral rect + cross).\n- Make image search roots configurable (remove hardcoded roots in `src/retained/render/image_loader.zig`); expose a small Zig API used by the Luau/native renderer integration.\n- Success: the acceptance scene shows a loaded image (with tint) and a missing image placeholder without repeated logs.",
    "complete": false,
    "priority": "high",
    "complexity": "high"
  },
  {
    "title": "Configurable default fonts for Tailwind tokens",
    "description": "- Make `font-ui`, `font-mono`, `font-game`, and `font-dyslexic` resolution configurable for integrations (instead of hardcoded FontId mapping).\n- Expose a small Zig API (and Luau-facing hook if needed) to set default font ids/families at startup.\n- Keep existing Tailwind tokens stable; only add configuration, do not rename tokens.\n- Success: the acceptance scene can switch its base font family via integration config without code changes in the renderer.",
    "complete": false,
    "priority": "medium",
    "complexity": "medium"
  },
  {
    "title": "UIListLayout: flex order-* support",
    "description": "- Add `order-*` and `order-[n]` parsing to `src/retained/style/tailwind.zig`.\n- Apply order during flex layout: set Yoga order in `src/retained/layout/yoga.zig` (or stable-sort children before layout as a fallback).\n- Preserve stability when orders match (document order tie-break).\n- Success: the acceptance scene renders flex children in the expected order with mixed `order-*` values.",
    "complete": false,
    "priority": "high",
    "complexity": "medium"
  },
  {
    "title": "UIScrollingFrame: per-axis overflow + scrollbars",
    "description": "- Add Tailwind tokens in `src/retained/style/tailwind.zig`: `overflow-scroll`, `overflow-x-scroll`, `overflow-y-scroll` (independent axis enablement).\n- Extend scroll runtime state in `src/retained/core/types.zig` as needed to track enabled axes.\n- Update `renderScrollFrame` in `src/retained/render/mod.zig` to respect axis enablement for wheel/touch scrolling and scrollbar visibility.\n- Success: the acceptance scene includes (1) vertical-only scroll and (2) both-axes scroll, with correct scrollbars and input behavior.",
    "complete": false,
    "priority": "high",
    "complexity": "medium"
  },
  {
    "title": "Picking/getNodeRect correctness",
    "description": "- Make `pickNodeAt` + `getNodeRect` match render output for transforms, clipping (including scroll + overflow-hidden), and z-index.\n- Ensure queries do not require a prior render pass (derive z-index/clip from class spec when `node.visual` is stale).\n- Add a small verification path (harness assertions or debug overlay) that validates pick/rect results against the acceptance scene.",
    "complete": false,
    "priority": "high",
    "complexity": "high"
  },
  {
    "title": "UIGradient: background gradients",
    "description": "- Define a retained gradient contract (props and/or Tailwind tokens) and store it on nodes using `types.Gradient` (`src/retained/core/types.zig`).\n- Implement gradient rendering in `src/retained/render/cache.zig` or `src/retained/render/direct.zig` with rotation, color+alpha stops, and compatibility with opacity + corner radius.\n- Success: the acceptance scene shows at least one rounded, semi-transparent gradient background.",
    "complete": false,
    "priority": "medium",
    "complexity": "high"
  },
  {
    "title": "Tweening helpers in Luau",
    "description": "- Implement a minimal tween system in `scripts/` driven by `update(dt, input)` (no Zig changes required): position, size, rotation, color, opacity.\n- Include easing styles (linear, quad, cubic), cancellation/override, and completion callbacks.\n- Demonstrate at least one tween in the acceptance scene.",
    "complete": false,
    "priority": "medium",
    "complexity": "medium"
  },
  {
    "title": "Cleanup/perf pass (allocations + cache invalidation)",
    "description": "- Ensure any new heap allocations are explicitly owned and freed (node-owned data freed in `SolidNode.deinit`).\n- Audit layout/paint invalidation for new features (percent sizing, aspect ratio, scroll axis, gradients) to avoid stale caches.\n- Reduce per-frame scratch allocations where easy wins exist (reuse buffers, avoid repeated parsing).",
    "complete": false,
    "priority": "low",
    "complexity": "medium"
  }
]
